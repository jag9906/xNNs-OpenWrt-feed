'use strict';var mail=function(){var extend={path:{origin:v___location_origin,prefix:v___location_prefix,extensions:v___server_extensions_path,css:v___server_css_path,js:v___server_js_path},variable:{mail_switch:function mail_switch(){return $t_uri_webmail;}},content:get_pjax_content,load:load,plugin:{scroll:function scroll(target,options){if(typeof target==='string'){$(target).mCustomScrollbar(options);}else{$(target[0]).mCustomScrollbar('scrollTo',target[1],{scrollOffset:[$(target[0]),3,4]});}}}};var folders=function(){var data={file:{fancytree:'jquery.fancytree'},selector:{navigation:'aside .navigation',folders:'data-mail-folders'},options:{tree:{escapeTitles:false,autoActivate:false,autoScroll:true,keyboard:false,toggleEffect:false},scroll:{axis:'xy',theme:'minimal',keyboard:false,scrollInertia:300,scrollButtons:true,autoHideScrollbar:false}},plugin:{tree:function tree(source){source=source==='get'?'getTree':source==='node'?'getActiveNode':Object.assign(data.options.tree,{source:source,activate:function activate(e,d){_tree.adjust();_tree.expand(d.node);extend.content(data.url.link+encodeURIComponent(d.node.key));}});return $(_tree.container).fancytree(source);}},url:{link:extend.path.origin+extend.path.prefix+'/mailbox/index.cgi?id='}};var _tree={fetched:0,container:'['+data.selector.folders+']',container_adjust:function container_adjust(){var container=$(this.container+' >:first'),content=$(this.container+' >>:first');if(container.height()>content.height()){container.css('height',content.height());}},init:function init(source){if(this.fetched===0){this.load();return;}if($(data.selector.navigation+' '+this.container).length===0){$(data.selector.navigation).prepend('<div '+data.selector.folders+'></div>');}else{return;}data.plugin.tree(source);extend.plugin.scroll(this.container,data.options.scroll);this.container_adjust();},expand:function expand(node){var expanded=node.isExpanded();!expanded&&node.toggleExpanded();},load:function load(){this.fetched=1;extend.load.bundle(extend.path.js+'/'+data.file.fancytree,extend.path.css+'/'+data.file.fancytree,extend.variable.mail_switch()?[get]:0,1);},reload:function reload(source){var _this=this;var tree=data.plugin.tree('get');tree.$container.empty();tree.reload(source);setTimeout(function(){_this.adjust();_this.expand(_this.node());},1e2);},node:function node(){return data.plugin.tree('node');},adjust:function adjust(){var $_=this.node();if($_&&$_.li&&$($_.li).length){extend.plugin.scroll([this.container,$($_.li)]);}this.container_adjust();}};function get(key){key=key?'?key='+key.replace(/&/g,'%26'):String();$.post(extend.path.extensions+'/mail/folders.cgi'+key+'',function(source){if(!!key){_tree.reload(source);}else{_tree.init(source);}});}function adjust(){_tree.adjust();}return{get:get,adjust:adjust};}();return{folders:{get:folders.get,adjust:folders.adjust}};}();
